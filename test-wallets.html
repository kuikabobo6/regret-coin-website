<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Wallets - $REGRET</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .wallet-test {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .wallet-btn {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .wallet-btn:hover {
            background: #357ABD;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .error {
            background: #ffe6e6;
            color: #d63031;
        }
        .success {
            background: #e6ffe6;
            color: #27ae60;
        }
    </style>
</head>
<body>
    <h1>üß™ Test de Conexi√≥n de Wallets</h1>
    <p>Abre la consola del navegador (F12) para ver los logs detallados.</p>

    <div class="wallet-test">
        <h3>Phantom</h3>
        <button class="wallet-btn" onclick="testWallet('phantom')">Test Phantom</button>
        <div id="phantom-result" class="result"></div>
    </div>

    <div class="wallet-test">
        <h3>Solflare</h3>
        <button class="wallet-btn" onclick="testWallet('solflare')">Test Solflare</button>
        <div id="solflare-result" class="result"></div>
    </div>

    <div class="wallet-test">
        <h3>Backpack</h3>
        <button class="wallet-btn" onclick="testWallet('backpack')">Test Backpack</button>
        <div id="backpack-result" class="result"></div>
    </div>

    <div class="wallet-test">
        <h3>Uniswap (Manual)</h3>
        <button class="wallet-btn" onclick="testWallet('uniswap')">Test Uniswap</button>
        <div id="uniswap-result" class="result"></div>
    </div>

    <script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>
    <script>
// Funci√≥n de logging para mostrar en UI
function logToUI(walletType, message, type = 'info') {
    const resultDiv = document.getElementById(`${walletType}-result`);
    const timestamp = new Date().toLocaleTimeString();
    const logEntry = `[${timestamp}] ${message}\n`;

    resultDiv.textContent += logEntry;
    resultDiv.className = `result ${type}`;
    resultDiv.scrollTop = resultDiv.scrollHeight;

    console.log(`[${walletType.toUpperCase()}] ${message}`);
}

// Conectar wallet - Versi√≥n con debugging detallado
async function testWallet(walletType) {
    const resultDiv = document.getElementById(`${walletType}-result`);
    resultDiv.textContent = '';
    resultDiv.className = 'result';

    logToUI(walletType, `üîç Intentando conectar ${walletType}...`);

    try {
        let publicKey = null;

        switch(walletType) {
            case 'phantom':
                logToUI(walletType, 'üîç Verificando Phantom...');
                logToUI(walletType, `window.solana: ${!!window.solana}`);
                logToUI(walletType, `window.solana.isPhantom: ${!!window.solana?.isPhantom}`);

                if (window.solana && window.solana.isPhantom) {
                    logToUI(walletType, '‚úÖ Phantom detectada, conectando...');
                    const response = await window.solana.connect();
                    logToUI(walletType, `üìÑ Respuesta de Phantom: ${JSON.stringify(response, null, 2)}`);
                    logToUI(walletType, `üìÑ Tipo de respuesta: ${typeof response}`);

                    if (response && response.publicKey) {
                        publicKey = response.publicKey.toString();
                        logToUI(walletType, `‚úÖ PublicKey extra√≠da: ${publicKey}`, 'success');
                    } else if (response && typeof response === 'string') {
                        publicKey = response;
                        logToUI(walletType, `‚úÖ Respuesta como string: ${publicKey}`, 'success');
                    } else if (response && typeof response === 'object') {
                        logToUI(walletType, `üìÑ Propiedades del objeto: ${Object.keys(response).join(', ')}`);
                        publicKey = response.publicKey || response.address || response.toString();
                        logToUI(walletType, `‚úÖ PublicKey de objeto: ${publicKey}`, 'success');
                    } else {
                        logToUI(walletType, `‚ùå Respuesta inv√°lida: ${response}`, 'error');
                        throw new Error('Respuesta inv√°lida de Phantom');
                    }
                } else {
                    logToUI(walletType, '‚ùå Phantom no detectada', 'error');
                    throw new Error('Phantom no detectada. Instala la extensi√≥n de Phantom.');
                }
                break;

            case 'solflare':
                logToUI(walletType, 'üîç Verificando Solflare...');
                logToUI(walletType, `window.solflare: ${!!window.solflare}`);

                if (window.solflare) {
                    logToUI(walletType, '‚úÖ Solflare detectada, conectando...');
                    const response = await window.solflare.connect();
                    logToUI(walletType, `üìÑ Respuesta de Solflare: ${JSON.stringify(response, null, 2)}`);
                    logToUI(walletType, `üìÑ Tipo de respuesta: ${typeof response}`);

                    if (response && response.publicKey) {
                        publicKey = response.publicKey.toString();
                        logToUI(walletType, `‚úÖ PublicKey extra√≠da: ${publicKey}`, 'success');
                    } else if (response && typeof response === 'string') {
                        publicKey = response;
                        logToUI(walletType, `‚úÖ Respuesta como string: ${publicKey}`, 'success');
                    } else {
                        logToUI(walletType, `‚ùå Respuesta inv√°lida: ${response}`, 'error');
                        throw new Error('Respuesta inv√°lida de Solflare');
                    }
                } else {
                    logToUI(walletType, '‚ùå Solflare no detectada', 'error');
                    throw new Error('Solflare no detectada. Instala la extensi√≥n de Solflare.');
                }
                break;

            case 'backpack':
                logToUI(walletType, 'üîç Verificando Backpack...');
                logToUI(walletType, `window.backpack: ${!!window.backpack}`);

                if (window.backpack) {
                    logToUI(walletType, '‚úÖ Backpack detectada, conectando...');
                    const response = await window.backpack.connect();
                    logToUI(walletType, `üìÑ Respuesta de Backpack: ${JSON.stringify(response, null, 2)}`);
                    logToUI(walletType, `üìÑ Tipo de respuesta: ${typeof response}`);

                    if (response && response.publicKey) {
                        publicKey = response.publicKey.toString();
                        logToUI(walletType, `‚úÖ PublicKey extra√≠da: ${publicKey}`, 'success');
                    } else if (response && typeof response === 'string') {
                        publicKey = response;
                        logToUI(walletType, `‚úÖ Respuesta como string: ${publicKey}`, 'success');
                    } else {
                        logToUI(walletType, `‚ùå Respuesta inv√°lida: ${response}`, 'error');
                        throw new Error('Respuesta inv√°lida de Backpack');
                    }
                } else {
                    logToUI(walletType, '‚ùå Backpack no detectada', 'error');
                    throw new Error('Backpack no detectada. Instala la extensi√≥n de Backpack.');
                }
                break;

            case 'uniswap':
                logToUI(walletType, 'üîç Uniswap - conexi√≥n manual');
                const address = prompt('Ingresa tu direcci√≥n de wallet Solana (44 caracteres):');
                if (address && address.length === 44 && /^[1-9A-HJ-NP-Za-km-z]{44}$/.test(address)) {
                    publicKey = address;
                    logToUI(walletType, `‚úÖ Direcci√≥n manual v√°lida: ${publicKey}`, 'success');
                } else {
                    logToUI(walletType, `‚ùå Direcci√≥n inv√°lida: ${address}`, 'error');
                    throw new Error('Direcci√≥n de wallet inv√°lida');
                }
                break;

            default:
                throw new Error('Tipo de wallet no soportado');
        }

        if (!publicKey) {
            logToUI(walletType, '‚ùå No se pudo obtener la clave p√∫blica', 'error');
            throw new Error('No se pudo obtener la clave p√∫blica');
        }

        logToUI(walletType, `üéâ Wallet conectada exitosamente: ${publicKey}`, 'success');
        return publicKey;

    } catch (error) {
        logToUI(walletType, `üí• Error: ${error.message}`, 'error');
        logToUI(walletType, `Stack: ${error.stack}`, 'error');
        return null;
    }
}

// Detectar wallets disponibles al cargar
window.addEventListener('load', () => {
    console.log('üîç Detectando wallets disponibles...');
    console.log('Phantom:', !!window.solana?.isPhantom);
    console.log('Solflare:', !!window.solflare);
    console.log('Backpack:', !!window.backpack);
});
    </script>
</body>
</html>
